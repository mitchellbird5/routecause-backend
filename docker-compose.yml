services:
  mytravelapp-backend:
    image: mytravelapp/backend:1.0.0
    build: .
    depends_on:
      - osrm
      - nominatim
    environment:
      OSRM_URL: http://osrm:5000
      NOMINATIM_URL: http://nominatim:8080
      NODE_ENV: production
    restart: unless-stopped
    networks:
      - mytravelapp-network

  osrm:
    image: osrm/osrm-backend
    container_name: osrm
    volumes:
      - osrm-data:/data/osrm
    command: osrm-routed --algorithm mld /data/osrm/new-zealand-latest.osrm
    restart: unless-stopped
    networks:
      - mytravelapp-network

  nominatim:
    image: mediagis/nominatim:5.1
    container_name: nominatim
    volumes:
      - nominatim-data:/var/lib/postgresql/16/main
    environment:
      PBF_PATH: /var/lib/postgresql/16/main/new-zealand-latest.osm.pbf
      IMPORT: "0"
    restart: unless-stopped
    networks:
      - mytravelapp-network

volumes:
  osrm-data:
    external: true
    name: mytravelapp_osrm-data
  nominatim-data:
    external: true
    name: mytravelapp_nominatim-data

networks:
  mytravelapp-network:
    external: true
